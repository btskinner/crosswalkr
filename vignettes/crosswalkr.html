<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Benjamin Skinner" />

<meta name="date" content="2018-08-29" />

<title>Introduction to crosswalkr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 800px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Introduction to crosswalkr</h1>
<h4 class="author"><em>Benjamin Skinner</em></h4>
<h4 class="date"><em>2018-08-29</em></h4>



<p>Researchers often must compile master data sets from a number of smaller data sets that are not consistent in terms of variable names or value encodings. This can be especially true for large administrative data sets that span multiple years and/or departments. Other times, teams of researchers must work together to maintain a master data set and it is important for replicability and future collaboration that the team rely on consistent naming and encoding conventions.</p>
<p>For example, let’s say there are three flat files of student information that need to be merged into a single large data set for analysis.</p>
<div id="file-1" class="section level3">
<h3>File 1</h3>
<table>
<thead>
<tr class="header">
<th align="left">sid</th>
<th align="left">lname</th>
<th align="left">state</th>
<th align="left">t_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">Jackson</td>
<td align="left">VA</td>
<td align="left">74</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">Harrison</td>
<td align="left">KY</td>
<td align="left">86</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">Nixon</td>
<td align="left">IL</td>
<td align="left">78</td>
</tr>
</tbody>
</table>
</div>
<div id="file-2" class="section level3">
<h3>File 2</h3>
<table>
<thead>
<tr class="header">
<th align="left">stu_id</th>
<th align="left">last_name</th>
<th align="left">st</th>
<th align="left">test_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">4</td>
<td align="left">Washington</td>
<td align="left">35</td>
<td align="left">92</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">Roosevelt</td>
<td align="left">11</td>
<td align="left">67</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">Taylor</td>
<td align="left">47</td>
<td align="left">68</td>
</tr>
</tbody>
</table>
</div>
<div id="file-3" class="section level3">
<h3>File 3</h3>
<table>
<thead>
<tr class="header">
<th align="left">s_id</th>
<th align="left">name</th>
<th align="left">sta</th>
<th align="left">score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">7</td>
<td align="left">Tyler</td>
<td align="left">North Dakota</td>
<td align="left">91</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">Grant</td>
<td align="left">South Dakota</td>
<td align="left">82</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Adams</td>
<td align="left">Illinois</td>
<td align="left">89</td>
</tr>
</tbody>
</table>
<p>It is clear that these files contain the same basic information, but neither the names nor encodings for <code>state</code> | <code>st</code> | <code>sta</code> are consistent.</p>
<p>One solution is to just fix these one at a time before joining them. For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(crosswalkr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(labelled)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(haven)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">df1 &lt;-<span class="st"> </span>file_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> sid,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">           <span class="dt">last_name =</span> lname,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">           <span class="dt">stabbr =</span> stat,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">           <span class="dt">score =</span> t_score)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">df2 &lt;-<span class="st"> </span>file_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> stu_id,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">           <span class="dt">stabbr =</span> st,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">           <span class="dt">score =</span> test_score) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">stabbr =</span> <span class="kw">as.character</span>(stabbr))</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">df3 &lt;-<span class="st"> </span>file_<span class="dv">3</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">id =</span> s_id,</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">           <span class="dt">stabbr =</span> sta,</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">           <span class="dt">last_name =</span> name)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df1, df2, df3)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">df</a></code></pre></div>
<pre><code>##   id  last_name       stabbr score
## 1  1    Jackson           VA    74
## 2  2   Harrison           KY    86
## 3  3      Nixon           IL    78
## 4  4 Washington           35    92
## 5  5  Roosevelt           11    82
## 6  6     Taylor           47    89
## 7  7      Tyler North Dakota    91
## 8  8      Grant South Dakota    82
## 9  9      Adams     Illinois    89</code></pre>
<p>The problem, of course, is there is a lot of room for error since the renaming process has to be repeated for each data frame.</p>
</div>
<div id="using-a-crosswalk-file" class="section level3">
<h3>Using a crosswalk file</h3>
<p>Instead, it makes more sense to create a crosswalk data set that aligns old (or raw) column names with new (or clean) column names and, if desired, labels. The <code>crosswalk</code> to join these files could be:</p>
<table>
<thead>
<tr class="header">
<th align="left">clean</th>
<th align="left">label</th>
<th align="left">file_1_raw</th>
<th align="left">file_2_raw</th>
<th align="left">file_3_raw</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="left">Student ID</td>
<td align="left">sid</td>
<td align="left">stu_id</td>
<td align="left">s_id</td>
</tr>
<tr class="even">
<td align="left">last_name</td>
<td align="left">Student last name</td>
<td align="left">lname</td>
<td align="left">last_name</td>
<td align="left">name</td>
</tr>
<tr class="odd">
<td align="left">stabbr</td>
<td align="left">State abbreviation</td>
<td align="left">stat</td>
<td align="left">st</td>
<td align="left">sta</td>
</tr>
<tr class="even">
<td align="left">score</td>
<td align="left">Test score</td>
<td align="left">t_score</td>
<td align="left">test_score</td>
<td align="left">score</td>
</tr>
</tbody>
</table>
<p>The crosswalk file (<code>cw_file</code>) could be:</p>
<ol style="list-style-type: decimal">
<li>Data frame object already in memory<br />
</li>
<li>A string with path and name (<em>e.g.</em>, <code>'./path/to/crosswalk.csv'</code>) of a flat file of one of the following types:<br />
1. Comma separated (<code>*.csv</code>)<br />
2. Tab separated (<code>*.tsv</code>)<br />
3. Other delimited (<code>*.txt</code>) with <code>delimiter</code> option set to delimiter string (<em>e.g.</em>, <code>delimiter = '|'</code>)<br />
4. Excel (<code>*.xls</code> or <code>*.xlsx</code>) with <code>sheet</code> option set to sheet number or string name (defaulting to the first sheet)<br />
5. R data (<code>*.rdata</code>, <code>*.rda</code>, <code>*.rds</code>)<br />
6. Stata data (<code>*.dta</code>)</li>
</ol>
<p>If given a string to the <code>cw_file</code> argument, <code>renamefrom()</code> and <code>encodefrom()</code> determine the type of file by its ending.</p>
</div>
<div id="renaming" class="section level2">
<h2>Renaming</h2>
<p>To rename using the <code>renamefrom()</code> command:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">df1 &lt;-<span class="st"> </span><span class="kw">renamefrom</span>(file_<span class="dv">1</span>, <span class="dt">cw_file =</span> crosswalk, <span class="dt">raw =</span> file_<span class="dv">1</span>_raw, <span class="dt">clean =</span> clean, <span class="dt">label =</span> label)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">df2 &lt;-<span class="st"> </span><span class="kw">renamefrom</span>(file_<span class="dv">2</span>, <span class="dt">cw_file =</span> crosswalk, <span class="dt">raw =</span> file_<span class="dv">2</span>_raw, <span class="dt">clean =</span> clean, <span class="dt">label =</span> label)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">df3 &lt;-<span class="st"> </span><span class="kw">renamefrom</span>(file_<span class="dv">3</span>, <span class="dt">cw_file =</span> crosswalk, <span class="dt">raw =</span> file_<span class="dv">3</span>_raw, <span class="dt">clean =</span> clean, <span class="dt">label =</span> label)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df1, df2, df3)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">df</a></code></pre></div>
<pre><code>##   id  last_name       stabbr score
## 1  1    Jackson           VA    74
## 2  2   Harrison           KY    86
## 3  3      Nixon           IL    78
## 4  4 Washington           35    92
## 5  5  Roosevelt           11    82
## 6  6     Taylor           47    89
## 7  7      Tyler North Dakota    91
## 8  8      Grant South Dakota    82
## 9  9      Adams     Illinois    89</code></pre>
<p>And check out the labels:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">var_label</span>(df)</a></code></pre></div>
<pre><code>## $id
## [1] &quot;Student ID&quot;
## 
## $last_name
## [1] &quot;Student last name&quot;
## 
## $stabbr
## [1] &quot;State abbreviation&quot;
## 
## $score
## [1] &quot;Test score&quot;</code></pre>
<p>As new raw data files are added to the project, they could simply be given a new column in the crosswalk file that mapped their raw column names to the clean versions.</p>
</div>
<div id="encoding" class="section level2">
<h2>Encoding</h2>
<p>These same example files have inconsistent encodings for state: one uses two-letter abbreviations, another the FIPS code, and another the full name. Again, instead of fixing each one at a time, a separate crosswalk for encoding these values could be used. The <code>crosswalkr</code> package includes a state-level crosswalk, <code>stcrosswalk</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">data</span>(stcrosswalk)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">stcrosswalk</a></code></pre></div>
<pre><code>## # A tibble: 51 x 7
##    stfips stabbr stname            cenreg cenregnm  cendiv cendivnm       
##     &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;          
##  1      1 AL     Alabama                3 South          6 East South Cen…
##  2      2 AK     Alaska                 4 West           9 Pacific        
##  3      4 AZ     Arizona                4 West           8 Mountain       
##  4      5 AR     Arkansas               3 South          7 West South Cen…
##  5      6 CA     California             4 West           9 Pacific        
##  6      8 CO     Colorado               4 West           8 Mountain       
##  7      9 CT     Connecticut            1 Northeast      1 New England    
##  8     10 DE     Delaware               3 South          5 South Atlantic 
##  9     11 DC     District of Colu…      3 South          5 South Atlantic 
## 10     12 FL     Florida                3 South          5 South Atlantic 
## # ... with 41 more rows</code></pre>
<p>The <code>encodefrom()</code> function works much like <code>renamefrom()</code>. The only difference is that a vector of encoded values is returned that can be added to an existing dataframe.</p>
<p><code>encodefrom()</code> returns either base R factors or labels depending on whether the input data frame is a tibble.</p>
<div id="factor" class="section level4">
<h4>factor</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">df1<span class="op">$</span>state &lt;-<span class="st"> </span><span class="kw">encodefrom</span>(file_<span class="dv">1</span>, <span class="dt">var =</span> stat, stcrosswalk, <span class="dt">raw =</span> stabbr, <span class="dt">clean =</span> stfips, <span class="dt">label =</span> stname)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">df1</a></code></pre></div>
<pre><code>##   id last_name stabbr score    state
## 1  1   Jackson     VA    74 Virginia
## 2  2  Harrison     KY    86 Kentucky
## 3  3     Nixon     IL    78 Illinois</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">sapply</span>(df1, class)</a></code></pre></div>
<pre><code>##          id   last_name      stabbr       score       state 
## &quot;character&quot; &quot;character&quot; &quot;character&quot; &quot;character&quot;    &quot;factor&quot;</code></pre>
</div>
<div id="labelled-vector" class="section level4">
<h4>labelled vector</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">file_<span class="dv">1</span>_ &lt;-<span class="st"> </span>file_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_df</span>()</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">df1<span class="op">$</span>state &lt;-<span class="st"> </span><span class="kw">encodefrom</span>(file_<span class="dv">1</span>_, <span class="dt">var =</span> stat, stcrosswalk, <span class="dt">raw =</span> stabbr,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                        <span class="dt">clean =</span> stfips, <span class="dt">label =</span> stname)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">as_factor</span>(df1)</a></code></pre></div>
<pre><code>##   id last_name stabbr score    state
## 1  1   Jackson     VA    74 Virginia
## 2  2  Harrison     KY    86 Kentucky
## 3  3     Nixon     IL    78 Illinois</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">zap_labels</span>(df1)</a></code></pre></div>
<pre><code>##   id last_name stabbr score state
## 1  1   Jackson     VA    74    51
## 2  2  Harrison     KY    86    21
## 3  3     Nixon     IL    78    17</code></pre>
</div>
</div>
<div id="combined-example-dplyr-chain" class="section level2">
<h2>Combined example: <code>dplyr</code> chain</h2>
<p>The <code>renamefrom()</code> and <code>encodefrom()</code> functions can be combined in a <code>dplyr</code> chain.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">rbind</span>(file_<span class="dv">1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">            </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">            </span><span class="kw">renamefrom</span>(., crosswalk, file_<span class="dv">1</span>_raw, clean, label) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">stabbr =</span> <span class="kw">encodefrom</span>(., stabbr, stcrosswalk, stabbr, stfips, stname)),</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">            <span class="co">## append file 2</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">            file_<span class="dv">2</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="st">            </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="st">            </span><span class="kw">renamefrom</span>(., crosswalk, file_<span class="dv">2</span>_raw, clean, label) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">stabbr =</span> <span class="kw">encodefrom</span>(., stabbr, stcrosswalk, stfips, stfips, stname)),</a>
<a class="sourceLine" id="cb18-11" data-line-number="11"></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">            <span class="co">## append file 3</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13">            file_<span class="dv">3</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="st">            </span><span class="kw">tbl_df</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="st">            </span><span class="kw">renamefrom</span>(., crosswalk, file_<span class="dv">3</span>_raw, clean, label) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="st">            </span><span class="kw">mutate</span>(<span class="dt">stabbr =</span> <span class="kw">encodefrom</span>(., stabbr, stcrosswalk, stname, stfips, stname)))</a>
<a class="sourceLine" id="cb18-17" data-line-number="17"></a>
<a class="sourceLine" id="cb18-18" data-line-number="18">df</a></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   id    last_name  stabbr    score
##   &lt;chr&gt; &lt;chr&gt;      &lt;chr+lbl&gt; &lt;chr&gt;
## 1 1     Jackson    51        74   
## 2 2     Harrison   21        86   
## 3 3     Nixon      17        78   
## 4 4     Washington 35        92   
## 5 5     Roosevelt  11        82   
## 6 6     Taylor     47        89   
## 7 7     Tyler      38        91   
## 8 8     Grant      46        82   
## 9 9     Adams      17        89</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">as_factor</span>(df)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   id    last_name  stabbr               score
##   &lt;chr&gt; &lt;chr&gt;      &lt;fct&gt;                &lt;chr&gt;
## 1 1     Jackson    Virginia             74   
## 2 2     Harrison   Kentucky             86   
## 3 3     Nixon      Illinois             78   
## 4 4     Washington New Mexico           92   
## 5 5     Roosevelt  District of Columbia 82   
## 6 6     Taylor     Tennessee            89   
## 7 7     Tyler      North Dakota         91   
## 8 8     Grant      South Dakota         82   
## 9 9     Adams      Illinois             89</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
